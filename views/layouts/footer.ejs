    </main>

    <!-- Footer -->
    <% if (typeof user !== 'undefined' && user) { %>
    <footer class="bg-white border-t border-gray-200 mt-auto">
      <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
        <div class="text-center text-sm text-gray-500">
          © <%= new Date().getFullYear() %> Aplikasi Zakat Fitrah. Dibuat dengan
          ❤️ untuk umat.
        </div>
      </div>
    </footer>
    <% } %>

    <!-- Scripts -->
    <script>
      function toggleDropdown() {
        const dropdown = document.getElementById("dropdown-menu");
        if (dropdown) {
          dropdown.classList.toggle("hidden");
        }
      }

      // Close dropdown when clicking outside
      document.addEventListener("click", function (event) {
        const dropdown = document.getElementById("dropdown-menu");
        const button = event.target.closest("button");
        if (dropdown && (!button || !button.onclick)) {
          dropdown.classList.add("hidden");
        }
      });

      // Auto hide flash messages
      setTimeout(function () {
        const flashMessages = document.querySelectorAll(
          ".bg-green-100, .bg-red-100"
        );
        flashMessages.forEach(function (message) {
          message.style.display = "none";
        });
      }, 5000);

      // Form validation helpers
      function validateForm(formId) {
        const form = document.getElementById(formId);
        const inputs = form.querySelectorAll("input[required]");
        let isValid = true;

        inputs.forEach(function (input) {
          if (!input.value.trim()) {
            input.classList.add("border-red-500");
            isValid = false;
          } else {
            input.classList.remove("border-red-500");
          }
        });

        return isValid;
      }

      // Number formatting
      function formatRupiah(angka) {
        const number_string = angka.replace(/[^,\d]/g, "").toString();
        const split = number_string.split(",");
        const sisa = split[0].length % 3;
        let rupiah = split[0].substr(0, sisa);
        const ribuan = split[0].substr(sisa).match(/\d{3}/gi);

        if (ribuan) {
          const separator = sisa ? "." : "";
          rupiah += separator + ribuan.join(".");
        }

        rupiah = split[1] != undefined ? rupiah + "," + split[1] : rupiah;
        return rupiah;
      }

      function normalizeTableHeaderText(element) {
        if (!element) return "";
        const cloned = element.cloneNode(true);
        const hiddenElements = cloned.querySelectorAll("script, style");
        hiddenElements.forEach(function (node) {
          node.remove();
        });
        return cloned.textContent.replace(/\s+/g, " ").trim();
      }

      function applyResponsiveTableStack(table) {
        if (!table || table.dataset.noStackMobile === "true") {
          return;
        }

        const headerCells = Array.from(table.querySelectorAll("thead th"));
        const bodyRows = table.querySelectorAll("tbody tr");

        if (!headerCells.length || !bodyRows.length) {
          return;
        }

        const headers = headerCells.map(function (headerCell, index) {
          const label = normalizeTableHeaderText(headerCell);
          return label || "Kolom " + (index + 1);
        });

        bodyRows.forEach(function (row) {
          let currentColIndex = 0;
          const dataCells = row.querySelectorAll("td");

          dataCells.forEach(function (cell, fallbackIndex) {
            const span = Number(cell.getAttribute("colspan") || 1);
            const label =
              headers[currentColIndex] ||
              headers[fallbackIndex] ||
              "Kolom " + (fallbackIndex + 1);

            cell.setAttribute("data-label", label);
            currentColIndex += span;
          });
        });

        table.classList.add("responsive-stack-table");
      }

      function refreshResponsiveTableStack() {
        const tables = document.querySelectorAll("table");
        tables.forEach(function (table) {
          applyResponsiveTableStack(table);
        });
      }

      let responsiveTableRefreshQueued = false;
      function queueResponsiveTableStackRefresh() {
        if (responsiveTableRefreshQueued) {
          return;
        }

        responsiveTableRefreshQueued = true;
        window.requestAnimationFrame(function () {
          refreshResponsiveTableStack();
          responsiveTableRefreshQueued = false;
        });
      }

      window.refreshResponsiveTableStack = refreshResponsiveTableStack;

      document.addEventListener("DOMContentLoaded", function () {
        queueResponsiveTableStackRefresh();

        if (!window.__responsiveTableObserver) {
          const observer = new MutationObserver(function (mutations) {
            const shouldRefresh = mutations.some(function (mutation) {
              return mutation.addedNodes && mutation.addedNodes.length > 0;
            });

            if (shouldRefresh) {
              queueResponsiveTableStackRefresh();
            }
          });

          observer.observe(document.body, { childList: true, subtree: true });
          window.__responsiveTableObserver = observer;
        }
      });
    </script>
  </body>
</html>
